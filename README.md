Play-Scala-Mongo

### Setup Play
```scala

git clone git@github.com:sumitppawar/PlayMongoScala.git
cd PlayMongoScala
sbt run  //Play server starts at localhost:9000

```

### Setup Mongo
```scala
Download mongo
Create data data dir "/data/db"
//Start server
mongod --dbpath "/data/db"

```

### MongoDb notes

```
Why MonogoDb ?
-No Schema, adding new data is easy but in case rational db we can't add data wihout
    schema chage.
- Better concurrancy approach, only block a single document for write.
- Supports eventually consitance.
- Easy to setup replication.
- Store data as form of Document.

-Mongo comes with 'mongod' and 'mongo' process.
-'mongod' is daeman, which start mongodb at default port [27017] 
- 'monogo' is a mongoshel, a javascript interpreter which connects to server.
- Mongodb need its data dir to available.

mongod --dbpath ~/data/db 
mongo --port 27017

mongo commands
use Earth //User Earth DB
show collection //show collection in current db
db.users.save({_id:10, name:'Sumit Pawar'})  //Save user, if alraedy exist then override
db.users.insert({_id:10, name:'Sumit Pawar'}) //Will not override existing document. gives error
    if doc with given id is persent.

- MongoDb rules for document
    - It must have "_id" field. If not given then mongo will genrate for you.
    - Default id value is generated by ObjectId()
    - "_id" can anly value expect array.
    -Above is only rule will have on document.
db.users.save({"_id": {name: "Sumit"}, dob: "03/06/2018"}) //Valid
db.users.save({"_id": []}) // Not valid

Replication
-Porcess of duplicate data accros diffrent nodes.
-In replication usually we three thing
    1. PrimaryDb
    3. SencodaryDb
    4. Arbiter
-Only primary can write to db.
-If primary is down then mongo do election and majority voted secondary becomes primary.
-Arbiter does work of remove tie-up between nodes.
-If primary down then arbiter and secondary vote for secondary.

Replication setup
-Load conf from file 
    mongod -f  ~/db.conf
-Create replica
    mongod --port 4000  --dbpath /Users/sumit/data/db1 --replSet "Asia"
    mongod --port 5000  --dbpath /Users/sumit/data/db2 --replSet "Asia"
    mongod --port 6000  --dbpath /Users/sumit/data/db3 --replSet "Asia"
     
    config 
    {
      "_id": "Asia",
      "members": [
        {
          "_id": 0,
          "host": "localhost:4000",
          "priority": 10

        },
        {
                  "_id": 1,
                  "host": "localhost:5000"
         },
         {
                   "_id": 2,
                   "host": "localhost:6000",
                   "arbiterOnly": true
         }
      ]
    }
    
Monogo Backup
    sudo mongodump --db newdb --out /var/backups/mongobackups/`date +"%m-%d-%y"`

Mongo Restore
    sudo mongorestore --db newdb --drop /var/backups/mongobackups/01-20-16/newdb/    

Three folder
mongoadmin/data
mongoadmin/conf
mongoadmin/log

Conf File
specify datadir and log
clean shutdwon
    -service stop mongod
    -ctrl + c
    -db.shutdownServer()
    -dont do kill -9 pid [force kill]
    
    
 mongod.lock size 0 means mongod shutdown cleanly in datatdir   
 

Configuration
    - best to keep configuration inside conf
    - mongod --config /data/config/mongod.conf
    - Mongo supports YAML format but still support key value also 
    
   Defining mongod.conf
    -Make sure data dir and log dir is precreated 
   
   storage:
    dbPath: "/Users/sumit/data/db1" 
   systemLog:
    destination: file
    path: "/Users/sumit/data/db1/log/mongod.log"
    engine: mmapv1 or wiredTiger
   
Storage Engin
    default memory mapped storage engine(mmapv1)  ?
    -it levergae OS funtionality to flush and get data
     wiredTiger
     -Its mamnages it wons file, not uses os MM
     -it gives other feature as compression
     -Mostly used intensive write db, provide better locking on document
Swiching not work from one engine to another engine

Journaling 
nothing but when flush data to disk, defult flush every 100 milsec
db.serverStatus().dur

dataDirPerDb=true   {Default is false} 
    - Enable subfoldering per db, but when take backup u have coopy manually sppecific dir
    
net configuration
net:
  bindIp: 192.168.0.4
  port: 40000
 
to enable http Interface {should disble in prod}
net:
 http:
  enabled: true
  
  
Example
storage:
 dbPath: "/Users/sumit/data/db" 
 engine: mmapv1
 journal:
  enabled: true
  commitIntervalMs: 140

net:
 bindIp: 192.168.0.4
 port: 40000

systemLog:
 destination: file
 path: "/Users/sumit/data/db1/log/mongod.log"


Query Crash Course    
```

  